import{g as z}from"./singer-4cdff2f7.js";import{S as B}from"./index-ed3a47fa.js";import{h as p,g as S,i as w,y as b,r as x,H as L,o as f,f as R,w as T,d as v,c as g,e as y,t as m,F as I,z as k,A as j,n as D,J as G,k as E,s as V,a as C,T as A,N as F}from"./vendor-686b3c9c.js";import{_ as M,b as Y}from"./index-8bf5099d.js";function J(s){const c=30,a=p(null),e=p([]),l=p(0),r=p(0),u=p(0),h=S(()=>{if(l.value<0)return"";const o=s.data[r.value];return o?o.title:""}),n=S(()=>{const o=u.value;return{transform:`translate3d(0,${o>0&&o<c?o-c:0}px,0)`}});w(()=>s.data,async()=>{await b(),t()}),w(l,o=>{const d=e.value;for(let _=0;_<d.length-1;_++){const N=d[_],H=d[_+1];o>=N&&o<=H&&(r.value=_,u.value=H-o)}});function t(){const o=a.value.children;let d=0;e.value.length=0,e.value.push(d);for(let _=0;_<o.length;_++)d+=o[_].clientHeight,e.value.push(d)}function i(o){l.value=-o.y}return{groupRef:a,onScroll:i,fixedTitle:h,fixedStyle:n,currentIndex:r}}function K(s,c){const a=p(null),e=18,l=S(()=>s.data.map(t=>t.title)),r={};function u(t){const i=parseInt(t.target.dataset.index);r.y1=t.touches[0].pageY,r.anchorIndex=i,n(i)}function h(t){r.y2=t.touches[0].pageY;const i=(r.y2-r.y1)/e|0,o=r.anchorIndex+i;n(o)}function n(t){if(isNaN(t))return;t=Math.max(0,Math.min(t,l.value.length-1));const i=c.value.children[t];a.value.scroll.scrollToElement(i,0)}return{shortcutList:l,scrollRef:a,onShortcutTouchStart:u,onShortcutTouchMove:h}}const O={name:"index-list",components:{Scroll:B},emits:["select"],props:{data:{type:Array,default(){return[]}}},setup(s,{emit:c}){const{groupRef:a,onScroll:e,fixedTitle:l,fixedStyle:r,currentIndex:u}=J(s),{shortcutList:h,scrollRef:n,onShortcutTouchStart:t,onShortcutTouchMove:i}=K(s,a);function o(d){c("select",d)}return{onItemClick:o,groupRef:a,onScroll:e,fixedTitle:l,fixedStyle:r,currentIndex:u,shortcutList:h,scrollRef:n,onShortcutTouchStart:t,onShortcutTouchMove:i}}},q={ref:"groupRef"},P={class:"title"},Q=["onClick"],U={class:"avatar"},W={class:"name"},X={class:"fixed-title"},Z=["data-index"];function $(s,c,a,e,l,r){const u=x("scroll"),h=L("lazy");return f(),R(u,{class:"index-list",probeType:3,onScroll:e.onScroll,ref:"scrollRef"},{default:T(()=>[v("ul",q,[(f(!0),g(I,null,y(a.data,n=>(f(),g("li",{key:n.title,class:"group"},[v("h2",P,m(n.title),1),v("ul",null,[(f(!0),g(I,null,y(n.list,t=>(f(),g("li",{key:t.id,class:"item",onClick:i=>e.onItemClick(t)},[k(v("img",U,null,512),[[h,t.pic]]),v("span",W,m(t.name),1)],8,Q))),128))])]))),128))],512),k(v("div",{class:"fixed",style:D(e.fixedStyle)},[v("div",X,m(e.fixedTitle),1)],4),[[j,e.fixedTitle]]),v("div",{class:"shortcut",onTouchstart:c[0]||(c[0]=E((...n)=>e.onShortcutTouchStart&&e.onShortcutTouchStart(...n),["stop","prevent"])),onTouchmove:c[1]||(c[1]=E((...n)=>e.onShortcutTouchMove&&e.onShortcutTouchMove(...n),["stop","prevent"])),onTouchend:c[2]||(c[2]=E((...n)=>s.onShortcutTouchEnd&&s.onShortcutTouchEnd(...n),["stop","prevent"]))},[v("ul",null,[(f(!0),g(I,null,y(e.shortcutList,(n,t)=>(f(),g("li",{key:n,"data-index":t,class:G(["item",{current:e.currentIndex===t}])},m(n),11,Z))),128))])],32)]),_:1},8,["onScroll"])}var tt=M(O,[["render",$],["__scopeId","data-v-46ac19e3"]]);const et={components:{indexList:tt},name:"singer",data(){return{singers:[],selectedSinger:null}},async created(){const s=await z();this.singers=s.singers},methods:{selectSinger(s){this.selectedSinger=s,this.cacheSinger(s),this.$router.push({path:`/singer/${s.mid}`})},cacheSinger(s){V.session.set(Y,s)}}},nt={class:"singer"};function ot(s,c,a,e,l,r){const u=x("index-list"),h=x("router-view"),n=L("loading");return k((f(),g("div",nt,[C(u,{data:l.singers,onSelect:r.selectSinger},null,8,["data","onSelect"]),C(h,null,{default:T(({Component:t})=>[C(A,{appear:"",name:"slide"},{default:T(()=>[(f(),R(F(t),{data:l.selectedSinger},null,8,["data"]))]),_:2},1024)]),_:1})])),[[n,!l.singers.length]])}var at=M(et,[["render",ot],["__scopeId","data-v-7c99c648"]]);export{at as default};
